import numpy as np
import cv2


def preprocess(img):
    img = cv2.resize(img, (224, 224), interpolation=cv2.INTER_CUBIC)
    img = cv2.cvtColor(img, cv2.COLOR_BGR2YCR_CB)
    img_y = img[:, :, 0]
    img_cr = img[:, :, 1]
    img_cb = img[:, :, 2]
    img_y = np.expand_dims(np.expand_dims(img_y, 0), 0)
    img_y = img_y / 255.0
    img_y = np.ascontiguousarray(img_y)
    return img_y, img_cr, img_cb


def postprocess(img_y, img_cr, img_cb):
    target_size = (672, 672)
    img_y = np.reshape(img_y, (3, 3, 224, 224))
    img_y = np.transpose(img_y, (2, 0, 3, 1))
    img_y = np.reshape(img_y, target_size)
    img_y = img_y * 255.0
    img_y = np.clip(img_y, 0, 255)
    img_y = np.uint8(img_y)
    img_cr = cv2.resize(img_cr, target_size, cv2.INTER_CUBIC)
    img_cb = cv2.resize(img_cb, target_size, cv2.INTER_CUBIC)
    img = np.stack([img_y, img_cr, img_cb], 2)
    print(img.shape)
    img = cv2.cvtColor(img, cv2.COLOR_YCR_CB2BGR)
    return img
